FROM dockerregistry.ondewo.com:5000/nemo:master

RUN apt-get update && apt-get -y upgrade && \
	apt-get install -y git

COPY docker/test_requirements.txt .
RUN pip install -r test_requirements.txt --ignore-installed && \
    pip install git+https://github.com/TensorSpeech/TensorflowTTS.git
WORKDIR /opt

WORKDIR /opt/ondewo-t2s
COPY ./normalization ./normalization
COPY ./inference ./inference
COPY ./batch_server ./batch_server
COPY ./utils ./utils
COPY ./tests ./tests
COPY ./config ./config

ENV PYTHONPATH /opt/ondewo-t2s
CMD python -m pytest -vv --capture=no --junit-xml=log/"$TESTFILE" --ignore="tests/e2e" --ignore="tests/integration"
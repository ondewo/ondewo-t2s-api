FROM python:3.7

RUN apt-get -y update && apt-get -y upgrade

RUN pip install pip==20.0.2
COPY docker/demo_server_requirements.txt .
RUN pip install -r demo_server_requirements.txt --ignore-installed

WORKDIR /opt/ondewo-t2s
COPY ./demo_server ./demo_server
COPY ./utils ./utils
COPY ./ondewo-t2s-api ./ondewo-t2s-api

COPY ./Makefile .

RUN mkdir ondewo_grpc
RUN make generate_ondewo_protos

ENV PYTHONPATH /opt/ondewo-t2s
ENV FLASK_APP demo_server
CMD flask run --host=0.0.0.0 --port=50540
